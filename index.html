<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Vanilla by idevz</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Vanilla</h1>
        <h2>A MVC web framework for Lua powered by OpenResty</h2>

        <section id="downloads">
          <a href="https://github.com/idevz/vanilla/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/idevz/vanilla/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/idevz/vanilla" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h2>
<a id="vanilla--香草中文文档" class="anchor" href="#vanilla--%E9%A6%99%E8%8D%89%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3" aria-hidden="true"><span class="octicon octicon-link"></span></a>Vanilla / (香草<a href="README-zh.md">中文文档</a>)</h2>

<p><em>Vanilla is An OpenResty Lua MVC Web Framework.</em></p>

<p><img src="http://upload.jianshu.io/collections/images/225552/w-vanilla.png?imageMogr/thumbnail/300x300" alt="Vanilla"></p>

<h3>
<a id="maillist" class="anchor" href="#maillist" aria-hidden="true"><span class="octicon octicon-link"></span></a><em>MailList</em>
</h3>

<ul>
<li>vanilla-en <a href="mailto:vanilla-en@googlegroups.com">vanilla-en@googlegroups.com</a>
</li>
<li>vanilla-devel <a href="mailto:vanilla-devel@googlegroups.com">vanilla-devel@googlegroups.com</a>
</li>
<li>vanilla中文邮件列表 <a href="mailto:vanilla@googlegroups.com">vanilla@googlegroups.com</a>
</li>
</ul>

<h3>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span class="octicon octicon-link"></span></a><em>Install</em>
</h3>

<p><em>There are two ways to install:</em></p>

<ul>
<li>Make (recommended way)</li>
<li>Luarocks</li>
</ul>

<h4>
<a id="tips-of-make-install" class="anchor" href="#tips-of-make-install" aria-hidden="true"><span class="octicon octicon-link"></span></a><em>Tips of <code>make install</code>:</em>
</h4>

<p><em>Vanilla support many configuration options, many of those option have default value.</em></p>

<p>You can use default installation but if your enviroment values different from which vanilla default, please config it with yours.
Especially the <code>--openresty-path</code> option. you should make sure it's point to your turely OpenResty install path.
You can run command <code>./configure --help</code> to learn how to use those options. </p>

<p>Below is the installation of a simple example:</p>

<pre><code>./configure --prefix=/usr/local/vanilla --openresty-path=/usr/local/openresty

make install
</code></pre>

<h4>
<a id="tips-of-luarocks-install" class="anchor" href="#tips-of-luarocks-install" aria-hidden="true"><span class="octicon octicon-link"></span></a><em>Tips of <code>luarocks install</code>:</em>
</h4>

<p><em>You can use luarocks to install vanilla, but three point should be clear:</em></p>

<ol>
<li>Your luarocks should install with lua5.1.x because of the compatibility problems in ABIs between Lua and Luajit.</li>
<li>parameter NGX_PATH will be disabled in the nginx.conf.</li>
<li>make sure that command nginx is in your environment PATH.</li>
</ol>

<h3>
<a id="vanilla-usage" class="anchor" href="#vanilla-usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Vanilla usage</h3>

<h4>
<a id="vanilla-cmds" class="anchor" href="#vanilla-cmds" aria-hidden="true"><span class="octicon octicon-link"></span></a><em>Vanilla CMDs</em>
</h4>

<p><em>Vanilla provide two commands <code>vanilla</code>, and <code>vanilla-console</code>.</em></p>

<ul>
<li>
<code>vanilla</code> is for application building, service start, stop and so on.</li>
<li>
<code>vanilla-console</code> is an interactive command line， you can use it for debugging, testing, Lua learning...</li>
</ul>

<p>Run <code>vanilla</code> in command line, you can find command <code>vanilla</code> provide three options.</p>

<pre><code>vanilla
Vanilla v0.1.0-rc3, A MVC web framework for Lua powered by OpenResty.

Usage: vanilla COMMAND [ARGS] [OPTIONS]

The available vanilla commands are:
 new [name]             Create a new Vanilla application
 start                  Starts the Vanilla server
 stop                   Stops the Vanilla server

Options:
 --trace                Shows additional logs
</code></pre>

<h4>
<a id="building-up-an-application-skeleton" class="anchor" href="#building-up-an-application-skeleton" aria-hidden="true"><span class="octicon octicon-link"></span></a><em>Building up an application skeleton</em>
</h4>

<pre><code>vanilla new app_name
cd app_name
vanilla start [--trace]     -- default running in development environment.
-- under bash on linux
VA_ENV=production vanilla start [--trace]  -- add VA_ENV to set the running environment.
-- under tcsh on BSD
setenv VA_ENV production ; vanilla start [--trace]  -- add VA_ENV to set the running environment.
</code></pre>

<h4>
<a id="directory-structure" class="anchor" href="#directory-structure" aria-hidden="true"><span class="octicon octicon-link"></span></a><em>Directory Structure</em>
</h4>

<pre><code> /Users/zj-git/app_name/ tree ./
./
├── application
│   ├── bootstrap.lua --application boot
│   ├── controllers
│   │   ├── error.lua --application error handling, dealing with corresponding business under this path error
│   │   └── index.lua --vanilla hello world
│   ├── library       --local libs
│   ├── models 
│   │   ├── dao       --data handles for DB, APIs
│   │   │   └── table.lua
│   │   └── service   --encapsulations of DAOs
│   │       └── user.lua
│   ├── nginx         --openresy http phases
│   │   └── init.lua  --init_by_lua demo
│   ├── plugins
│   └── views         --one to one correspondence to controllers
│       ├── error     --error handle view layout
│       │   └── error.html
│       └── index     --index controller views
│           └── index.html
├── config
│   ├── application.lua --app basic configuration such as router,initialization settings...
│   ├── errors.lua    --app error conf
│   ├── nginx.conf    --nginx.conf skeleton
│   ├── nginx.lua     --nginx settings like lua_code_cache.
│   ├── waf-regs      --WAF rules
│   │   ├── args
│   │   ├── cookie
│   │   ├── post
│   │   ├── url
│   │   ├── user-agent
│   │   └── whiteurl
│   └── waf.lua       --app WAF config
├── logs
│   └── hack          --attack logs, keep path can be write
├── pub               --app content_by_lua_file path
    └── index.lua     --entrance file
</code></pre>

<h4>
<a id="indexcontroller-demo" class="anchor" href="#indexcontroller-demo" aria-hidden="true"><span class="octicon octicon-link"></span></a><em>IndexController Demo</em>
</h4>

<pre><code>local IndexController = {}

function IndexController:index()
    local view = self:getView()
    local p = {}
    p['vanilla'] = 'Welcome To Vanilla...'
    p['zhoujing'] = 'Power by Openresty'
    view:assign(p)
    return view:display()
end

return IndexController
</code></pre>

<h5>
<a id="template-demo-viewsindexindexhtml" class="anchor" href="#template-demo-viewsindexindexhtml" aria-hidden="true"><span class="octicon octicon-link"></span></a><em>Template demo (views/index/index.html)</em>
</h5>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;body&gt;
  &lt;img src="http://m1.sinaimg.cn/maxwidth.300/m1.sinaimg.cn/120d7329960e19cf073f264751e8d959_2043_2241.png"&gt;
  &lt;h1&gt;&lt;a href = 'https://github.com/idevz/vanilla'&gt;{{vanilla}}&lt;/a&gt;&lt;/h1&gt;&lt;h5&gt;{{zhoujing}}&lt;/h5&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<h3>
<a id="why-vanilla" class="anchor" href="#why-vanilla" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why Vanilla</h3>

<p><em>To answer this question, we just need to see what did Openresty and Vanilla have done.</em></p>

<h4>
<a id="openresty" class="anchor" href="#openresty" aria-hidden="true"><span class="octicon octicon-link"></span></a><em>Openresty</em>
</h4>

<ul>
<li>Provides processing HTTP requests a full set of the overall solution</li>
<li>Opened up a new way for Nginx module development, we can use Lua to deal with Web requests</li>
<li>Formed an increasingly perfect ecology, the ecological covers all aspects of high-performance Web services </li>
</ul>

<h4>
<a id="vanilla" class="anchor" href="#vanilla" aria-hidden="true"><span class="octicon octicon-link"></span></a><em>Vanilla</em>
</h4>

<ul>
<li>Implement a Web development routine debugging, error handling, exception handling</li>
<li>Implement complete processing of the request and plug-in mechanism, support routing protocol, the template engine configuration</li>
<li>Integration, encapsulates a series of Web development commonly used tool set, class library (cookies, application firewall, etc.)</li>
<li>Features easy to use and extend</li>
<li>Support  different environment (development, test, online)</li>
<li>Focus on the business development, not any about nginx nor OpenResty</li>
<li>Based on OpenResty, have all the good qualities of OpenResty</li>
<li>Automated, Nginx instruction set of configuration management</li>
<li>More reasonable use Openresty encapsulation of request processing Phase</li>
</ul>

<h3>
<a id="community" class="anchor" href="#community" aria-hidden="true"><span class="octicon octicon-link"></span></a>Community</h3>

<h4>
<a id="qq-groupswechat-public-no" class="anchor" href="#qq-groupswechat-public-no" aria-hidden="true"><span class="octicon octicon-link"></span></a><em>QQ Groups&amp;&amp;WeChat public no.</em>
</h4>

<ul>
<li><em>Openresty/Vanilla Dev:205773855 (Vanilla panel discussion related topics)</em></li>
<li><em>Openresty:34782325(Discuss OpenResty and all kinds of advanced technology)</em></li>
<li><em>WeChat public no. of Vanilla Dev:Vanilla-OpenResty(Vanilla related information, document push)</em></li>
</ul>

<p><a href="http://shang.qq.com/wpa/qunwpa?idkey=673157ee0f0207ce2fb305d15999225c5aa967e88913dfd651a8cf59e18fd459"><img src="http://pub.idqqimg.com/wpa/images/group.png" alt="QQ"></a></p>
      </section>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-28150381-2");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
